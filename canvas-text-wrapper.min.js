!function(a){function b(b,c,d){"use strict";function e(a){do{a=a.replace(/\n\n/g,"\n"+J+"\n")}while(a.indexOf("\n\n")>-1);return a}function f(a){w||(w=t.sizeToFill?b.font.split(/\b\d+px\b/i):t.font.split(/\b\d+px\b/i)),b.font=w[0]+a+"px"+w[1]}function g(){isNaN(t.lineHeight)?-1!==t.lineHeight.toString().indexOf("px")?I=parseInt(t.lineHeight):-1!==t.lineHeight.toString().indexOf("%")&&(I=parseInt(t.lineHeight)/100*D):I=D*t.lineHeight}function h(){if(t.sizeToFill){var a=c.trim().split(/\s+/).length,b=0,d=!1!==t.maxFontSizeToFill;do{if(d){if(!(++b<=t.maxFontSizeToFill))break;i(b)}else i(++b)}while(E<C&&F.join(" ").split(/\s+/).length==a);i(--b)}else j();t.justifyLines&&"auto"===t.lineBreak&&m(),q(),p(),o()}function i(a){f(a),I=a,j()}function j(){if(t.allowNewLine)for(var a=c.trim().split("\n"),b=0,d=0;b<a.length-1;b++)d+=a[b].trim().split(/\s+/).length,G.push(d);var e=c.trim().split(/\s+/);k(e),l(e),E=F.length*I}function k(a){var c,d,e,f;a.forEach(function(g,h){if(c="",(d=b.measureText(g).width)>B){for(var i=0;b.measureText(c+g[i]).width<=B&&i<g.length;i++)c+=g[i];e=g.slice(0,i),f=g.slice(i),a.splice(h,1,e,f)}})}function l(a){F=[];for(var c=0,d=0;c<a.length;d++)if(F[d]="","auto"===t.lineBreak){if(b.measureText(F[d]+a[c]).width>B)break;for(;b.measureText(F[d]+a[c]).width<=B&&c<a.length;)if(F[d]+=a[c]+" ",c++,t.allowNewLine)for(var e=0;e<G.length;e++)if(G[e]===c){d++,F[d]="";break}F[d]=F[d].trim()}else F[d]=a[c],c++}function m(){for(var a,c,d,e=0;e<F.length;e++)d=b.measureText(F[e]).width,(!a||d>a)&&(a=d,c=e);var f,g,h,i,j,k=" ";for(e=0;e<F.length;e++)if(e!==c&&!((f=F[e].trim().split(/\s+/).length)<=1)){F[e]=F[e].trim().split(/\s+/).join(k),g=b.measureText(k).width,h=(a-b.measureText(F[e]).width)/g,i=h/(f-1),j="";for(var l=0;l<i;l++)j+=k;F[e]=F[e].trim().split(k).join(j)}}function n(a,c,d){var e=b.measureText(a).width;switch(b.textAlign){case"center":c-=e/2;break;case"right":c-=e}b.beginPath(),b.moveTo(c,d),b.lineTo(c+e,d),b.stroke()}function o(){for(var a=J+" ",c=0;c<F.length;c++)H.y=parseInt(H.y)+I,F[c]!==a&&(b.fillText(F[c],H.x,H.y),t.strokeText&&b.strokeText(F[c],H.x,H.y),"underline"===t.textDecoration.toLocaleLowerCase()&&n(F[c],H.x,H.y))}function p(){b.textAlign=t.textAlign,"center"==t.textAlign?H.x=z/2:"right"==t.textAlign?H.x=z-t.paddingX:H.x=t.paddingX}function q(){"middle"==t.verticalAlign?H.y=(A-E)/2:"bottom"==t.verticalAlign?H.y=A-E-t.paddingY:H.y=t.paddingY}function r(){if("string"!=typeof c)throw new TypeError("The second parameter must be a String.");if(isNaN(D))throw new TypeError('Cannot parse "font".');if(isNaN(I))throw new TypeError('Cannot parse "lineHeight".');if("left"!==t.textAlign.toLocaleLowerCase()&&"center"!==t.textAlign.toLocaleLowerCase()&&"right"!==t.textAlign.toLocaleLowerCase())throw new TypeError('Property "textAlign" must be set to either "left", "center", or "right".');if("top"!==t.verticalAlign.toLocaleLowerCase()&&"middle"!==t.verticalAlign.toLocaleLowerCase()&&"bottom"!==t.verticalAlign.toLocaleLowerCase())throw new TypeError('Property "verticalAlign" must be set to either "top", "middle", or "bottom".');if("boolean"!=typeof t.justifyLines)throw new TypeError('Property "justifyLines" must be a Boolean.');if(isNaN(t.paddingX))throw new TypeError('Property "paddingX" must be a Number.');if(isNaN(t.paddingY))throw new TypeError('Property "paddingY" must be a Number.');if("boolean"!=typeof t.fitParent)throw new TypeError('Property "fitParent" must be a Boolean.');if("auto"!==t.lineBreak.toLocaleLowerCase()&&"word"!==t.lineBreak.toLocaleLowerCase())throw new TypeError('Property "lineBreak" must be set to either "auto" or "word".');if("boolean"!=typeof t.sizeToFill)throw new TypeError('Property "sizeToFill" must be a Boolean.');if("boolean"!=typeof t.strokeText)throw new TypeError('Property "strokeText" must be a Boolean.');if("none"!==t.textDecoration.toLocaleLowerCase()&&"underline"!==t.textDecoration.toLocaleLowerCase())throw new TypeError('Property "textDecoration" must be set to either "none" or "underline".')}var s={font:"18px Arial, sans-serif",sizeToFill:!1,maxFontSizeToFill:!1,lineHeight:1,allowNewLine:!0,lineBreak:"auto",textAlign:"left",verticalAlign:"top",justifyLines:!1,paddingX:0,paddingY:0,fitParent:!1,strokeText:!1,textDecoration:"none"},t={};for(var u in s)t[u]=d.hasOwnProperty(u)?d[u]:s[u];var v=b.canvas;b.font=t.font,b.textBaseline="bottom";var w,x="undefined"!=typeof global?global.devicePixelRatio:a.devicePixelRatio,y=x,z=(t.fitParent?v.parentNode.clientWidth:v.width)/y,A=(t.fitParent?v.parentNode.clientHeight:v.height)/y,B=z-2*t.paddingX,C=A-2*t.paddingY,D=t.font.match(/\d+(px|em|%)/g)?+t.font.match(/\d+(px|em|%)/g)[0].match(/\d+/g):18,E=0,F=[],G=[],H={x:0,y:0},I=0,J="​";c=e(c),f(D),g(),r(),h()}"module"in a&&"exports"in module?module.exports=b:a.CanvasTextWrapper=b}(this);